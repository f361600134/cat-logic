<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
      
<head th:include="head :: htmlhead" th:with="title='协议生成管理'">
</head>

<input id="version" th:value="${version}"  hidden="true">
<input id="id" th:value="${id}"  hidden="true">
	<h1 align="center" style="color:#FF5722"  th:text="'当前使用的版本为'+${version}"> </h1>
<a th:href="'/zproto/module/viewModule?version='+${version}"><p align="center">回到模块页</p>
</a>

<body>
<form class="layui-form" action="" lay-filter="example">
    <!-- 对象表格 -->
    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
	  <legend>模块对象信息</legend>
	</fieldset>

    <table class="layui-hide" id="beanInfo" lay-filter="beanInfo"></table>
 	<script type="text/html" id="barDemo">
  	  <!--<a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>-->
  	  <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
	</script>
	
<!--     依赖对象表格 -->
	<fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
	  <legend>依赖对象定义</legend>
	</fieldset>
    <table class="layui-hide" id="assistBeanInfo" lay-filter="assistBeanInfo"></table>
 	<script type="text/html" id="barDemo">
  	  <!--<a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>-->
	  <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a> 
	</script> 
</form>

<script type="text/javascript"  th:inline="none">
layui.use('table', function(){
	  var table = layui.table;
	  
	  table.render({
	    elem: '#beanInfo'
	    ,url:'/zproto/setting/versionList'
	    ,toolbar: 'default' //开启头部工具栏，并为其绑定左侧模板
	    ,defaultToolbar: ['filter', 'exports', 'print', { //自定义头部工具栏右侧图标。如无需自定义，去除该参数即可
	      title: '提示'
	      ,layEvent: 'LAYTABLE_TIPS'
	      ,icon: 'layui-icon-tips'
	    }]
	    ,title: '用户数据表'
    	,totalRow: true
	    ,cols: [
	    	[
	    		{type: 'checkbox', fixed: 'left'}
                ,{field: 'field', title: '字段', edit: 'text', width:100, fixed: 'left'}
                ,{field: 'type', title: '类型', edit: 'text', width:120}
                ,{field: 'desc', title: '描述', edit: 'text', width:200}
                ,{field: 'init', title: '默认初始化', edit: 'text', width:120}
                ,{field: 'keyword', title: '关键字', edit: 'text', width:120}
                ,{fixed: 'right', title:'操作', toolbar: '#barDemo'}
	    	]
	    ]
	  });
	  //监听头工具栏事件
	  table.on('toolbar(beanInfo)', function(obj){
	    var checkStatus = table.checkStatus(obj.config.id)
	    ,data = checkStatus.data; //获取选中的数据
	    switch(obj.event){
	      case 'add':
	        layer.open({
	            type: 2 //此处以iframe举例
	            ,title: '新增字段'
	            ,area: ['400px', '500px']
	            ,shade: 0
	            ,maxmin: true
	            ,offset: [ //为了演示，随机坐标
	                0
	                ,0
	            ]
	            ,content: '/zproto/module/addBeanPropertiesView'
	            ,zIndex: layer.zIndex //重点1
	            ,success: function(layero){
	                layer.setTop(layero); //重点2
	            }
	        });
	      break;
	      case 'update':
// 	        if(data.length === 0){
// 	          layer.msg('请选择一行');
// 	        } else if(data.length > 1){
// 	          layer.msg('只能同时编辑一个');
// 	        } else {
// 	          layer.alert('编辑 [id]：'+ checkStatus.data[0].id);
// 	        }
	      break;
	      case 'delete':
// 	        if(data.length === 0){
// 	          layer.msg('请选择一行');
// 	        }else if(data.length >= 2){
// 	          layer.msg('防误删,每次最多删除1条数据');
// 	        } 
// 	        else {
// 	        	var dels = [];
// 	        	data.forEach(function(n,i){
// 	        		dels.push(n.version);
// 	        	});
// 	        	layer.confirm('真的删除么?', function(index){
// 	                layer.close(index);
// 	                $.ajax({
// 	                    type: 'get',
// 	                    url: '/zproto/setting/deleteVersion',
// 	                    dataType:"json", //返回格式为json
// 	                    data:{versions:dels}, //参数值
// 	                    contentType: 'application/x-www-form-urlencoded',
// 	                    success: function(ret){
// 	                        if(ret.code==0){
// 	                            layer.alert("删除成功！");
// 	                            location.reload();//重新加载页面表格
// 	                        }else{
// 	                            layer.alert(ret.tips);
// 	                        }
// 	                    },
// 	                    error: function(jqXHR){console.log(jqXHR)},
// 	                });
// 	                //向服务端发送删除指令
// 	            });
// 	        }
	      break;
	    };
	  });
	  
// 	  //监听行工具事件
// 	  table.on('tool(beanInfo)', function(obj){
// 	    var data = obj.data;
// 	    if(obj.event === 'del'){
// 	      layer.confirm('真的删除行么', function(index){
// 	        obj.del();
// 	        layer.close(index);
// 	      });
// 	    } else if(obj.event === 'edit'){
// 	      layer.prompt({
// 	        formType: 2
// 	        ,value: data.email
// 	      }, function(value, index){
// 	        obj.update({
// 	          email: value
// 	        });
// 	        layer.close(index);
// 	      });
// 	    }
// 	  });
	});
</script>

<script type="text/javascript"  th:inline="none">
layui.use('table', function(){
	  var table = layui.table;
	  
	  table.render({
	    elem: '#assistBeanInfo'
	    ,url:'/zproto/setting/versionList'
	    ,toolbar: 'default' //开启头部工具栏，并为其绑定左侧模板
	    ,defaultToolbar: ['filter', 'exports', 'print', { //自定义头部工具栏右侧图标。如无需自定义，去除该参数即可
	      title: '提示'
	      ,layEvent: 'LAYTABLE_TIPS'
	      ,icon: 'layui-icon-tips'
	    }]
	    ,title: '用户数据表'
    	,totalRow: true
	    ,cols: [
	    	[
	    		{type: 'checkbox', fixed: 'left'}
                ,{field: 'entityName', title: '依赖对象名', edit: 'text', width:100, fixed: 'left'}
                ,{field: 'field', title: '字段', edit: 'text', width:100, fixed: 'left'}
                ,{field: 'type', title: '类型', edit: 'text', width:120}
                ,{field: 'desc', title: '描述', edit: 'text', width:200}
                ,{field: 'init', title: '默认初始化', edit: 'text', width:120}
                ,{field: 'keyword', title: '关键字', edit: 'text', width:120}
                ,{fixed: 'right', title:'操作', toolbar: '#barDemo'}
	    	]
	    ]
	  });
	  //监听头工具栏事件
	  table.on('toolbar(assistBeanInfo)', function(obj){
	    var checkStatus = table.checkStatus(obj.config.id)
	    ,data = checkStatus.data; //获取选中的数据
	    switch(obj.event){
	      case 'add':
	        layer.open({
	            type: 2 //此处以iframe举例
	            ,title: '新增字段'
	            ,area: ['400px', '500px']
	            ,shade: 0
	            ,maxmin: true
	            ,offset: [ //为了演示，随机坐标
	                0
	                ,0
	            ]
	            ,content: '/zproto/module/addBeanPropertiesView'
	            ,zIndex: layer.zIndex //重点1
	            ,success: function(layero){
	                layer.setTop(layero); //重点2
	            }
	        });
	      break;
	      case 'update':
// 	        if(data.length === 0){
// 	          layer.msg('请选择一行');
// 	        } else if(data.length > 1){
// 	          layer.msg('只能同时编辑一个');
// 	        } else {
// 	          layer.alert('编辑 [id]：'+ checkStatus.data[0].id);
// 	        }
	      break;
	      case 'delete':
// 	        if(data.length === 0){
// 	          layer.msg('请选择一行');
// 	        }else if(data.length >= 2){
// 	          layer.msg('防误删,每次最多删除1条数据');
// 	        } 
// 	        else {
// 	        	var dels = [];
// 	        	data.forEach(function(n,i){
// 	        		dels.push(n.version);
// 	        	});
// 	        	layer.confirm('真的删除么?', function(index){
// 	                layer.close(index);
// 	                $.ajax({
// 	                    type: 'get',
// 	                    url: '/zproto/setting/deleteVersion',
// 	                    dataType:"json", //返回格式为json
// 	                    data:{versions:dels}, //参数值
// 	                    contentType: 'application/x-www-form-urlencoded',
// 	                    success: function(ret){
// 	                        if(ret.code==0){
// 	                            layer.alert("删除成功！");
// 	                            location.reload();//重新加载页面表格
// 	                        }else{
// 	                            layer.alert(ret.tips);
// 	                        }
// 	                    },
// 	                    error: function(jqXHR){console.log(jqXHR)},
// 	                });
// 	                //向服务端发送删除指令
// 	            });
// 	        }
	      break;
	    };
	  });
	  
// 	  //监听行工具事件
// 	  table.on('tool(assistBeanInfo)', function(obj){
// 	    var data = obj.data;
// 	    if(obj.event === 'del'){
// 	      layer.confirm('真的删除行么', function(index){
// 	        obj.del();
// 	        layer.close(index);
// 	      });
// 	    } else if(obj.event === 'edit'){
// 	      layer.prompt({
// 	        formType: 2
// 	        ,value: data.email
// 	      }, function(value, index){
// 	        obj.update({
// 	          email: value
// 	        });
// 	        layer.close(index);
// 	      });
// 	    }
// 	  });
	});
</script>

</body>
</html>
