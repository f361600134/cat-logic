<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">

<head th:include="head :: htmlhead" th:with="title='协议生成管理'"></head>

<!-- <link rel=stylesheet href="../codemirror/doc/docs.css"> -->
<!-- codemirror核心css -->
<link rel="stylesheet" href="../codemirror/lib/codemirror.css">
<!-- <link rel="stylesheet" href="../codemirror/addon/fold/foldgutter.css"> -->
<!-- <link rel="stylesheet" href="../codemirror/addon/dialog/dialog.css"> -->
<link rel="stylesheet" href="../codemirror/theme/monokai.css">
<link rel="stylesheet" href="../codemirror/addon/hint/show-hint.css">
<!-- codemirror核心js -->
<script src="../codemirror/lib/codemirror.js"></script>
<script src="../codemirror/addon/search/searchcursor.js"></script>
<script src="../codemirror/addon/search/search.js"></script>
<script src="../codemirror/addon/dialog/dialog.js"></script>
<script src="../codemirror/addon/edit/matchbrackets.js"></script>
<script src="../codemirror/addon/edit/closebrackets.js"></script>
<!-- <script src="../codemirror/addon/comment/comment.js"></script> -->
<!-- <script src="../codemirror/addon/wrap/hardwrap.js"></script> -->
<!-- <script src="../codemirror/addon/fold/foldcode.js"></script> -->
<!-- <script src="../codemirror/addon/fold/brace-fold.js"></script> -->
<!-- 语言类型 -->
<script src="../codemirror/mode/javascript/javascript.js"></script>
<script src="../codemirror/mode/clike/clike.js"></script>
<script src="../codemirror/keymap/sublime.js"></script>
<script src="../codemirror/addon/hint/show-hint.js"></script>
<script src="../codemirror/addon/hint/anyword-hint.js"></script>

<!-- 编辑模板页 -->
<body>
<form class="layui-form" action="">
<div class="layui-form-item">
<div class="layui-input-block">
    <button  id="submit" class="layui-btn" lay-submit lay-filter="runCode">Run</button>
</div>
</div>
<div class="layui-form-item">
<div class="layui-inline">
<div id="test9" class="demo-tree demo-tree-box" ></div>
</div>
<div class="layui-inline">
	<textarea class="form-control" id="code" name="code"></textarea>
</div>
<div class="layui-inline">
	<textarea class="form-control" id="show" name="show"></textarea>
</div>
</div>
</form>

<script type="text/javascript"  th:inline="none">
//根据DOM元素的id构造出一个展示器
var shower = CodeMirror.fromTextArea(document.getElementById("show"), {
    mode: "text/x-java", //实现java代码高亮
    lineNumbers: true,	//显示行号
    theme: "monokai",	//设置主题
    lineWrapping: true,	//代码折叠
    foldGutter: true,
    gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"],
    matchBrackets: true,	//括号匹配
//     keyMap: "sublime",		//键盘映射
    autoCloseBrackets: true,//开启花括号补全
    showCursorWhenSelecting: true,//选中显示鼠标
    tabSize: 2, 				//tab空格数量
    readOnly: true       //只读
});
shower.setSize('460px', '850px');     //设置代码框的长宽
shower.setValue("");    //先代码框的值清空

//根据DOM元素的id构造出一个编辑器
var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
    mode: "text/x-custom", //实现自定义模式
    lineNumbers: true,	//显示行号
    theme: "monokai",	//设置主题
    lineWrapping: true,	//代码折叠
    foldGutter: true,
    gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"],
    matchBrackets: true,	//括号匹配
    keyMap: "sublime",		//键盘映射
    autoCloseBrackets: true,//开启花括号补全
    showCursorWhenSelecting: true,//选中显示鼠标
    tabSize: 2,				//tab空格数量
    hintOptions: { // 自定义提示选项
        completeSingle: false, // 当匹配只有一项的时候是否自动补全
    }
})
editor.on('change', editor => {
	//shower.setValue(editor.getValue());
    $("#code").text(editor.getValue());
});
editor.on('keypress', () => {
	//编译器内容更改事件
    editor.showHint();
});
editor.setSize('460px', '850px');     //设置代码框的长宽
//操作系统判断
var mac = CodeMirror.keyMap.default == CodeMirror.keyMap.macDefault;
CodeMirror.keyMap.default[(mac ? "Cmd" : "Ctrl")] = "autocomplete";
//anyword autocomplete
CodeMirror.commands.autocomplete = function(cm) {
  cm.showHint({hint: CodeMirror.hint.anyword});
}
setTimeout(() => {
   this.editor.refresh();
   this.shower.refresh();
},100);//让编辑器每次在调用的时候进行自动刷新

//表单操作
layui.use(function(){
    var form = layui.form;
    var tree = layui.tree;
    
    var data1 = [{
        title: '代码'
            ,id: 1
            ,children: [{
              title: 'Entity.ftl'
            },{
              title: 'EntityPo.ftl'
            },{
              title: 'EntityService.ftl'
            }]
          },{
            title: '协议'
            ,id: 2
            ,children: [{
              title: 'proto.ftl'
            },{
              title: 'protoId.ftl'
            }]
          }];
    
    form.on('submit(runCode)', function (data) {
        var e = data.field.code;
        $.ajax({
            type: 'POST',
            url: '/zproto/module/runCode',
            data: e,
            dataType: 'JSON',
            contentType: "application/json; charset=utf-8",
            success: function(data){
                var str = data.tips;
                shower.setValue(data.data);
                if(data.code == 0){
                	layer.msg(str, {icon: 1});
                }else{
                	layer.msg(str, {icon: 2});
                }
            },
            //error: function(jqXHR){console.log(jqXHR)},
        });
        return false;
});
  //开启节点操作图标
    tree.render({
      elem: '#test9'
      ,data: data1
      ,edit: ['add', 'update', 'del'] //操作节点的图标
      ,click: function(obj){
        layer.msg(JSON.stringify(obj.data));
      }
    });
});



</script> 
	
</body>
</html>
