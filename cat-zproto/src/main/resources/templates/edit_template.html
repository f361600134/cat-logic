<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">

<head th:include="head :: htmlhead" th:with="title='协议生成管理'"></head>

<link rel=stylesheet href="../codemirror/doc/docs.css">
<link rel="stylesheet" href="../codemirror/lib/codemirror.css">
<link rel="stylesheet" href="../codemirror/addon/fold/foldgutter.css">
<link rel="stylesheet" href="../codemirror/addon/dialog/dialog.css">
<link rel="stylesheet" href="../codemirror/theme/monokai.css">
<script src="../codemirror/lib/codemirror.js"></script>
<script src="../codemirror/addon/search/searchcursor.js"></script>
<script src="../codemirror/addon/search/search.js"></script>
<script src="../codemirror/addon/dialog/dialog.js"></script>
<script src="../codemirror/addon/edit/matchbrackets.js"></script>
<script src="../codemirror/addon/edit/closebrackets.js"></script>
<script src="../codemirror/addon/comment/comment.js"></script>
<script src="../codemirror/addon/wrap/hardwrap.js"></script>
<script src="../codemirror/addon/fold/foldcode.js"></script>
<script src="../codemirror/addon/fold/brace-fold.js"></script>
<script src="../codemirror/mode/javascript/javascript.js"></script>
<script src="../codemirror/keymap/sublime.js"></script>

<!-- 编辑模板页 -->
<body>
<form class="layui-form" action="">
<div class="layui-form-item">
<div class="layui-input-block">
    <button  id="submit" class="layui-btn" lay-submit lay-filter="runCode">Run</button>
</div>
</div>

<div class="layui-form-item">
<div class="layui-inline">
模板列表1<br>
模板列表1<br>
模板列表1<br>
模板列表1<br>
模板列表1<br>
</div>
<div class="layui-inline">
	<textarea class="form-control" id="code" name="code"></textarea>
</div>
<div class="layui-inline">
	<textarea class="form-control" id="show" name="show"></textarea>
</div>
</div>
</form>

<script type="text/javascript"  th:inline="none">
//根据DOM元素的id构造出一个编辑器
var shower = CodeMirror.fromTextArea(document.getElementById("show"), {
    mode: "javascript", //实现groovy代码高亮
    lineNumbers: true,	//显示行号
    theme: "monokai",	//设置主题
    lineWrapping: true,	//代码折叠
    foldGutter: true,
    gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"],
    matchBrackets: true,	//括号匹配
    keyMap: "sublime",		//键盘映射
    autoCloseBrackets: true,//开启花括号补全
    showCursorWhenSelecting: true,//选中显示鼠标
    tabSize: 2, 				//tab空格数量
    readOnly: true       //只读
});
shower.setSize('800px', '850px');     //设置代码框的长宽
shower.setValue("");    //先代码框的值清空

//根据DOM元素的id构造出一个编辑器
var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
    mode: "javascript", //实现groovy代码高亮
    lineNumbers: true,	//显示行号
    theme: "monokai",	//设置主题
    lineWrapping: true,	//代码折叠
    foldGutter: true,
    gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"],
    matchBrackets: true,	//括号匹配
    keyMap: "sublime",		//键盘映射
    autoCloseBrackets: true,//开启花括号补全
    showCursorWhenSelecting: true,//选中显示鼠标
    tabSize: 2				//tab空格数量
    //readOnly: true,        //只读
})
editor.on('change', editor => {
	//shower.setValue(editor.getValue());
    $("#code").text(editor.getValue());
});
editor.setSize('800px', '850px');     //设置代码框的长宽
editor.setValue("");    //先代码框的值清空
//editor.setValue(obj.scriptCode);    //给代码框赋值

//表单操作
layui.use(function(){
    var form = layui.form;
    form.on('submit(runCode)', function (data) {
        var e = data.field.code;
        $.ajax({
            type: 'POST',
            url: '/zproto/module/runCode',
            data: e,
            dataType: 'JSON',
            contentType: "application/json; charset=utf-8",
            success: function(data){
                var str = data.tips;
                if(data.code == 0){
                	shower.setValue(data.data);
                	layer.msg(str, {icon: 1});
                }else{
                	layer.msg(str, {icon: 2});
                }
            },
            //error: function(jqXHR){console.log(jqXHR)},
        });
        return false;
});});

setTimeout(() => {
   this.editor.refresh();
   this.shower.refresh();
},100);//让编辑器每次在调用的时候进行自动刷新

</script> 
	
</body>
</html>
